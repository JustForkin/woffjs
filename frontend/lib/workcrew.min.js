WorkCrew=function(a,b){this.filename=a;this.count=b||4;this.queue=[];this.results=[];this.pool=[];this.working={};this.uuid=0;this.fillPool()};WorkCrew.prototype.onfinish=function(){};WorkCrew.prototype.oncomplete=function(a){return[a.id,a.result]};WorkCrew.prototype.addWork=function(a){a.id=a.id||this.uuid++;this.queue.push(a);this.processQueue();return a.id};
WorkCrew.prototype.processQueue=function(){if(0==this.queue.length&&this.pool.length==this.count){if(this.onfinish)this.onfinish()}else for(;0<this.queue.length&&0<this.pool.length;){var a=this.queue.shift(),b=this.pool.shift();b.id=a.id;this.working[b.id]=b;b.postMessage(a.msg,a.transferables)}};
WorkCrew.prototype.addWorker=function(){var a=new Worker(this.filename),b=this;a.onmessage=function(a){var c=this.id;delete b.working[this.id];this.id=null;b.pool.push(this);b.oncomplete({id:c,result:a});b.processQueue()};this.pool.push(a)};WorkCrew.prototype.fillPool=function(){for(var a=0;a<this.count;a++)this.addWorker()};